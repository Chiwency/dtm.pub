# 架构

## 架构

dtm包括服务端和客户端，整体架构图如下：

![arch](../imgs/arch.jpg)

dtm本身由Go编写，他提供了多语言分布式事务的支持，主要是通过非常薄的各语言SDK做到

## 角色

整个分布式事务的运行过程中，一共有三个角色参与，和OPEN/X XA事务标准类似，但也会有一些区别

- RM-资源管理器：RM管理分布式事务中的本地事务，负责相关数据的修改、提交、回滚、补偿等操作。通常对应一个微服务。
- AP-应用程序：AP会注册全局事务，按照业务规则，注册子事务，调用RM接口。通常对应一个微服务。
- TM-事务管理器：每个全局事务在TM注册，每个子事务也注册到TM。TM会协调所有的RM，将同一个全局事务的不同子事务，全部提交或全部回滚。对应dtm服务实例。

## 术语

假设一个嵌套事务如下所示：
![nested_trans](../imgs/nested_trans.jpg)

我们定义术语如下：

- 事务分支：我们把每个服务管理的全局事务组成部分，称为事务分支，Accout服务会在全局事务上，注册一个事务分支
- 分支操作：对于Accout服务，在TCC事务模式下，会实现Try/Confirm/Cancel三个操作，多个分支操作配合完成一个分支事务
- 本地事务：Accout服务可能访问一个数据库，创建一个本地事务，也可能访问多个数据库，创建多个本地事务
